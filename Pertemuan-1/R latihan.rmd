---
title: "MPDW Tugas 1"
author: "Rafi AKbar Wibawa"
date: "2023-09-02"
output: html_document
---
```{r}
library("forecast")
library("graphics")
library("TTR")
library("TSA")
library("rio")
```

## Impor Data

```{r}
data <- import("https://raw.githubusercontent.com/rafi2411/MPDW-STA1341/main/Pertemuan-1/Data/Raw%20Data.csv")
colnames(data) <- c("Waktu", "NO2")
data$Waktu<- ts(data$Waktu,frequency = 24)
```

```{r}
ts.plot(data, xlab="Time Period ", ylab="Reading",
        main = "Time Series Plot")
points(data)
```

```{r}
a = round(80/100*nrow(data))
train <- data[1:a,]
test <- data[a+1:216,]
test <- na.omit(test)
trainu <- ts(train$Waktu,frequency = 24)
test$Waktu<- ts(test$Waktu,frequency = 24)
```

```{r}
plot(data, col = "red", main = "Plot semua data")
points(data)

plot(train, col="steelblue",main="Plot data latih")
points(train)

plot(test, col="orange",main="Plot data latih")
points(test)
```

```{r}
summary(train)
```

```{r}
library(ggplot2)
library(ggplot2)
ggplot() + 
  geom_line(data = train, aes(x = Waktu, y = NO2, col = "Data Latih")) +
  geom_line(data = test, aes(x = Waktu, y = NO2, col = "Data Uji")) +
  labs(x = "Periode Waktu", y = "NO2", color = "Legend") +
  scale_colour_manual(name="Keterangan:", breaks = c("Data Latih", "Data Uji"),
                      values = c("blue", "red")) + 
  theme_bw() + theme(legend.position = "bottom",
                     plot.caption = element_text(hjust=0.5, size=12))
```



Selanjutnya melakukan pembagian data dan mengubahnya menjadi data deret waktu.

```{r}
#membagi data menjadi training dan testing
a = round(80/100*nrow(data))
training <- data[1:a,2]
testing <- data[a+1:216,2]
testing <- na.omit(testing)
train<-ts(training, frequency = 24)
test<-ts(testing, frequency = 24)
```

Kemudian akan dilakukan eskplorasi dengan plot data deret waktu sebagai berikut.

```{r}
#Membuat plot time series
plot(data, col="red",main="Plot semua data")
points(data)

plot(train, col="blue",main="Plot data latih")
points(train)

plot(test, col="green",main="Plot data uji")
points(test)
```

Metode Holt-Winter untuk peramalan data musiman menggunakan tiga persamaan pemulusan yang terdiri atas persamaan untuk level $(L_t)$, trend $(B_t)$, dan komponen seasonal / musiman $(S_t)$ dengan parameter pemulusan berupa $\alpha$, $\beta$, dan $\gamma$. Metode Holt-Winter musiman terbagi menjadi dua, yaitu metode aditif dan metode multiplikatif. Perbedaan persamaan dan NO2ntoh datanya adalah sebagai berikut.

![](images/Perbandingan%20model%20aditif.png){width="609"}

![](images/example%20additive-multiplicative.png)

Pemulusan data musiman dengan metode Winter dilakukan menggunakan fungsi `HoltWinters()` dengan memasukkan argumen tambahan, yaitu `gamma()` dan `seasonal()` . Arguman `seasonal()` diinisialisasi menyesuaikan jenis musiman, aditif atau multiplikatif.

### Winter Aditif

Perhitungan dengan model aditif dilakukan jika plot data asli menunjukkan fluktuasi musiman yang relatif stabil (konstan).

#### Pemulusan

```{r}
#Pemulusan dengan winter aditif 
winter1 <- HoltWinters(train,alpha=0.2,beta=0.1,gamma=0.1,seasonal = "additive")
winter1$fitted
xhat1 <- winter1$fitted[,1]

winter1.opt<- HoltWinters(train, alpha= NULL,  beta = NULL, gamma = NULL, seasonal = "additive")
winter1.opt
winter1.opt$fitted
xhat1.opt <- winter1.opt$fitted[,1]
```

#### Peramalan

```{r}
#Forecast
forecast1 <- predict(winter1, n.ahead = length(test))
forecast1.opt <- predict(winter1.opt, n.ahead = length(test))
```

#### Plot Deret Waktu

```{r}
#Plot time series
plot(train,main="Winter 0.2;0.1;0.1",type="l",col="black",
     xlim=c(1,10),pch=12)
lines(xhat1,type="l",col="red")
lines(xhat1.opt,type="l",col="blue")
lines(forecast1,type="l",col="red")
lines(forecast1.opt,type="l",col="blue")
legend("topleft",c("Actual Data",expression(paste(winter1)),
                   expression(paste(winter1.opt))),cex=0.5,
       col=c("black","red","blue"),lty=1)
```

```{r}
#Akurasi data training
SSE1<-winter1$SSE
MSE1<-winter1$SSE/length(train)
RMSE1<-sqrt(MSE1)
akurasi1 <- matrix(c(SSE1,MSE1,RMSE1))
row.names(akurasi1)<- c("SSE", "MSE", "RMSE")
colnames(akurasi1) <- c("Akurasi")
akurasi1

SSE1.opt<-winter1.opt$SSE
MSE1.opt<-winter1.opt$SSE/length(train)
RMSE1.opt<-sqrt(MSE1.opt)
akurasi1.opt <- matrix(c(SSE1.opt,MSE1.opt,RMSE1.opt))
row.names(akurasi1.opt)<- c("SSE1.opt", "MSE1.opt", "RMSE1.opt")
colnames(akurasi1.opt) <- c("Akurasi")
akurasi1.opt

akurasi1.train = data.frame(Model_Winter = c("Winter 1","Winter1 optimal"),
                            Nilai_SSE=c(SSE1,SSE1.opt),
                            Nilai_MSE=c(MSE1,MSE1.opt),Nilai_RMSE=c(RMSE1,RMSE1.opt))
akurasi1.train
```

#### Akurasi Data Uji

```{r}
#Akurasi Data Testing
forecast1<-data.frame(forecast1)
test<-data.frame(test)
selisih1<-forecast1-test
SSEtesting1<-sum(selisih1^2)
MSEtesting1<-SSEtesting1/nrow(test)
RMSEtesting1 <-sqrt(MSEtesting1)

forecast1.opt<-data.frame(forecast1.opt)
selisih1.opt<-forecast1.opt-test
SSEtesting1.opt<-sum(selisih1.opt^2)
MSEtesting1.opt<-SSEtesting1.opt/nrow(test)
RMSEtesting1.opt <-sqrt(MSEtesting1.opt)
akurasi1.opt.test = data.frame(Model_Winter = c("Winter 1","Winter1 optimal"),
                            Nilai_SSE=c(SSEtesting1,SSEtesting1.opt),
                            Nilai_MSE=c(MSEtesting1,MSEtesting1.opt),Nilai_RMSE=c(RMSEtesting1,RMSEtesting1.opt))
akurasi1.opt.test
```
```